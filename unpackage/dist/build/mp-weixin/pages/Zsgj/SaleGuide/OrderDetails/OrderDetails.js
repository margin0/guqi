(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/Zsgj/SaleGuide/OrderDetails/OrderDetails"],{4026:function(e,o,t){"use strict";t.r(o);var n=t("464c"),r=t.n(n);for(var i in n)["default"].indexOf(i)<0&&function(e){t.d(o,e,(function(){return n[e]}))}(i);o["default"]=r.a},"464c":function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=t("7dcd"),r=null,i={data:function(){return{orderType:"",visible:!1,maskCloseAble:!0,defaultValue:"110101",column:3,name:"",phone:"",city:"",area:"",ab:{recipientName:"",code:"",phoneNumber:""},orderNo:"",orderAmount:"",from:"",detls:{isAddress:""},abList:[],fpList:[],commodityCode:"",pickupMethod:"快递",expressCompany:"",trackingNumber:"",onlylook:1,cz:"",jlList:{managerName:"",managerNo:"",managerAccount:""},dyList:{tourGuideName:"",tourGuideNo:"",tourGuideAccount:""}}},components:{cityPicker:function(){Promise.all([t.e("common/vendor"),t.e("uni_modules/piaoyi-cityPicker/components/piaoyi-cityPicker/piaoyi-cityPicker")]).then(function(){return resolve(t("c390"))}.bind(null,t)).catch(t.oe)}},onShow:function(){this.queryOrderInfoByOrderNoForBpm()},onLoad:function(e){r=this,console.log(e),this.orderType=e.orderType,this.orderNo=e.orderNo,this.from=e.from,this.abInfo=e.abInfo,this.fpInfo=e.fpInfo,this.onlylook=e.onlylook,this.cz=e.cz,e.jlList&&(this.jlList=JSON.parse(e.jlList)),e.dyList&&(this.dyList=JSON.parse(e.dyList))},methods:{queryOrderInfoByOrderNoForBpm:function(){var o=e.getStorageSync("basicData"),t=JSON.parse(o),i={orderNo:this.orderNo,sid:t.sid,role:t.role};(0,n.queryOrderInfoByOrderNoForBpm)(i).then((function(e){r.detls=e,"否"==e.isAddress&&"待发货"==e.status&&0==r.onlylook&&"收货地址"==r.cz&&r.open(),"待发货"==e.status&&0==r.onlylook&&"确认发货"==r.cz&&r.fpopen(),"待登记"==e.commissionStatus&&0==r.onlylook&&"分佣登记"==r.cz&&r.fyopen()})).catch((function(o){e.showToast({title:o.data.msg||"queryOrderInfoByOrderNoForBpm接口异常,请稍后再试",icon:"none"})}))},selectOption:function(e){r.pickupMethod=e},checkPz:function(o){e.previewImage({indicator:"none",loop:!1,urls:[o]})},updateOrderStatusForBpm:function(o,t,i){"确认发货"==i?this.fpopen():e.showModal({title:"",content:"是否"+i+"？",confirmColor:"#C0272C",success:function(t){t.confirm&&(0,n.updateOrderStatusForBpm)({orderNo:o,status:"已取消"}).then((function(o){e.showToast({title:i+"成功",duration:2e3});var t=setTimeout((function(){r.queryOrderInfoByOrderNoForBpm(),clearTimeout(t)}),1500)})).catch((function(o){e.showToast({title:o.data.msg||"updateOrderStatusForBpm接口异常,请稍后再试",icon:"none"})}))}})},orderRefundForBpm:function(o){var t=this,r=e.getStorageSync("basicData"),i=JSON.parse(r);e.showModal({title:"",content:"订单：【"+o+"】确认要退款吗？",confirmColor:"#C0272C",success:function(r){r.confirm&&(0,n.orderRefundForBpm)({orderNo:o,sid:i.sid,role:i.role}).then((function(o){e.showToast({title:"操作成功：预计三个工作日内退款金额返回您的支付账户",duration:2e3});var n=setTimeout((function(){t.queryOrderInfoByOrderNoForBpm(),clearTimeout(n)}),1500)})).catch((function(o){e.showToast({title:o.data.msg||"orderRefundForBpm-退款接口异常,请稍后再试",icon:"none"})}))}})},getFp:function(o,t){var n=e.getStorageSync("basicData"),i=JSON.parse(n);queryUserInvoiceList({userOpenid:i.userOpenid}).then((function(n){n.length>0?r.fp=n[0]:console.log(""),r.fpList=n,"InvoiceList"==o&&t&&(r.fp=JSON.parse(t)),e.getStorageSync("emailAddress")&&(r.fp.email=e.getStorageSync("emailAddress"))})).catch((function(o){e.showToast({title:o.data.msg||"queryUserInvoiceList接口异常,请稍后再试",icon:"none"})}))},openCp:function(){this.visible=!0},confirm:function(e){console.log(e),this.city=e.name,this.provinceName=e.provinceName,this.cityName=e.cityName,this.areaName=e.areaName,this.visible=!1},cancel:function(){this.visible=!1},open:function(){this.$refs.popup.open("bottom")},fpopen:function(){this.$refs.popup1.open("bottom")},fyopen:function(){this.$refs.popup2.open("bottom")},close:function(){this.$refs.popup.close()},fpclose:function(){this.$refs.popup1.close()},fyclose:function(){this.$refs.popup2.close()},selectRy:function(o){"导游"==o?e.redirectTo({url:"/pages/Zsgj/PList/GuideList/GuideList?from=/pages/Zsgj/SaleGuide/OrderDetails/OrderDetails&onlylook=0&cz=分佣登记&orderNo="+this.orderNo+"&jlList="+JSON.stringify(this.jlList)}):e.redirectTo({url:"/pages/Zsgj/PList/ManagerList/ManagerList?from=/pages/Zsgj/SaleGuide/OrderDetails/OrderDetails&onlylook=0&cz=分佣登记&orderNo="+this.orderNo+"&dyList="+JSON.stringify(this.dyList)})},save:function(){var o=e.getStorageSync("basicData"),t=JSON.parse(o);return""==this.name?(e.showToast({title:"请输入收货人姓名",icon:"none"}),!1):""!=this.phone&&/^1[3-9]\d{9}$/.test(this.phone)?""==this.city?(e.showToast({title:"请选择所在地区",icon:"none"}),!1):""==this.area?(e.showToast({title:"请输入详细地址",icon:"none"}),!1):void(0,n.bindAddressForBpm)({sid:t.sid,role:t.role,orderNo:r.orderNo,recipientName:r.name,phoneNumber:r.phone,address:r.city+r.area}).then((function(o){e.showToast({title:"保存成功",duration:2e3});var t=setTimeout((function(){r.close(),r.queryOrderInfoByOrderNoForBpm(),clearTimeout(t)}),1500)})).catch((function(o){e.showToast({title:o.data.msg||"bindAddressForBpm接口异常,请稍后再试",icon:"none"})})):(e.showToast({title:"请输入正确的手机号",icon:"none"}),!1)},fysave:function(){var o=e.getStorageSync("basicData"),t=JSON.parse(o);if(""==r.jlList.managerName)return e.showToast({title:"请选择厂方人员",icon:"none"}),!1;(0,n.registerCommissionForBpm)({orderNo:r.detls.orderNo,sid:t.sid,role:t.role,tourGuideName:r.dyList.tourGuideName,tourGuideNo:r.dyList.tourGuideNo,tourGuideAccount:r.dyList.tourGuideAccount,managerName:r.jlList.managerName,managerNo:r.jlList.managerNo,managerAccount:r.jlList.managerAccount}).then((function(o){e.showToast({title:"登记成功",duration:2e3});var t=setTimeout((function(){r.fyclose(),r.queryOrderInfoByOrderNoForBpm(),clearTimeout(t)}),1500)})).catch((function(o){e.showToast({title:o.data.msg||"registerCommissionForBpm接口异常,请稍后再试",icon:"none"})}))},fpsave:function(){var o=e.getStorageSync("basicData"),t=JSON.parse(o);if("快递"==r.pickupMethod){if(""==r.expressCompany)return e.showToast({title:"请输入快递公司",icon:"none"}),!1;if(""==r.trackingNumber)return e.showToast({title:"请输入快递单号",icon:"none"}),!1;if("是"!=r.detls.isAddress)return e.showToast({title:"该订单未填写收货地址，请先填写收货地址才能发货",icon:"none"}),!1}e.showModal({title:"",content:"是否确认发货？",confirmColor:"#C0272C",success:function(o){o.confirm&&(0,n.updateOrderStatusForBpm)({orderNo:r.detls.orderNo,status:"待收货",sid:t.sid,role:t.role,pickupMethod:r.pickupMethod,expressCompany:"快递"==r.pickupMethod?r.expressCompany:"",trackingNumber:"快递"==r.pickupMethod?r.trackingNumber:""}).then((function(o){e.showToast({title:"确认发货成功",duration:2e3});var t=setTimeout((function(){r.fpclose(),r.queryOrderInfoByOrderNoForBpm(),clearTimeout(t)}),1500)})).catch((function(o){e.showToast({title:o.data.msg||"updateOrderStatusForBpm接口异常,请稍后再试",icon:"none"})}))}})},go:function(o){"确认发货"==o&&this.orderNo?e.showModal({title:"",content:"是否确认发货？",confirmColor:"#C0272C",success:function(o){if(o.confirm){var t=e.getStorageSync("basicData");JSON.parse(t);updateOrderStatusForUser({orderNo:r.orderNo,status:"已完成"}).then((function(o){e.showToast({title:"确认发货成功",duration:2e3});var t=setTimeout((function(){e.navigateTo({url:"/pages/MyOrderList/MyOrderList?orderType=已完成"}),clearTimeout(t)}),1500)})).catch((function(o){e.showToast({title:o.data.msg||"updateOrderStatusForUser接口异常,请稍后再试",icon:"none"})}))}}}):"去付款"==o?e.navigateTo({url:"/pages/CashierDesk/CashierDesk?orderAmount="+this.detls.orderAmount+"&orderNo="+this.detls.orderNo}):"收货地址"==o?"待发货"==this.orderType&&this.open():"开发票"==o?this.fpopen():"查看发票"==o&&e.navigateTo({url:"/pages/InvoiceList/InvoiceDetails/InvoiceDetails?orderNo="+this.orderNo})},chooseImage:function(o){var t="https://bpmcs.gujing.cn/apps_ba/r";console.log("url_1111111111111====》》》》》》"+t),e.chooseImage({count:1,sizeType:["compressed"],success:function(n){var i=n.tempFiles[0].name,s=i.match(/\.([^\.]+)$/),a=(s?s[1]:"").toLowerCase();if(console.log("~~~~~~~~~~~22~~~~"+a),sessionStorage.setItem("extension",a),["jpg","png","jpeg","bmp"].includes(a)){var c=e.getStorageSync("basicData"),u=JSON.parse(c),d=n.tempFiles[0],l=t+"/uf?";l+="appId=com.awspaas.user.apps.gujingfactorydirect",l=l+"&sid="+u.sid,l+="&repositoryName=factory",l+="&groupValue=picture",l+="&fileValue=pz",l=l+"&extParam={orderNo:'"+o+"'}",e.uploadFile({url:l,filePath:d.path,name:"file",formData:{},success:function(o){var t=JSON.parse(o.data);if("ok"==t.data.result&&t.data&&t){e.showToast({title:"上传凭证成功",duration:2e3});var n=setTimeout((function(){r.queryOrderInfoByOrderNoForBpm(),clearTimeout(n)}),1500)}else e.showToast({title:"上传凭证失败"+t.data.msg,duration:2e3})},fail:function(o){console.log("上传失败",o),e.showToast({title:"上传凭证失败，请重试",duration:2e3})}})}else e.showToast({title:"支付凭证只支持图片",icon:"none"})},fail:function(o){e.showToast({title:"操作失败，请重试",duration:2e3})}})}}};o.default=i}).call(this,t("df3c")["default"])},5080:function(e,o,t){"use strict";(function(e,o){var n=t("47a9");t("7ea0");n(t("3240"));var r=n(t("d282"));e.__webpack_require_UNI_MP_PLUGIN__=t,o(r.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])},ad1e:function(e,o,t){"use strict";var n=t("f3cb"),r=t.n(n);r.a},d282:function(e,o,t){"use strict";t.r(o);var n=t("ec4e"),r=t("4026");for(var i in r)["default"].indexOf(i)<0&&function(e){t.d(o,e,(function(){return r[e]}))}(i);t("ad1e");var s=t("828b"),a=Object(s["a"])(r["default"],n["b"],n["c"],!1,null,"24c873b4",null,!1,n["a"],void 0);o["default"]=a.exports},ec4e:function(e,o,t){"use strict";t.d(o,"b",(function(){return r})),t.d(o,"c",(function(){return i})),t.d(o,"a",(function(){return n}));var n={uniPopup:function(){return t.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(t.bind(null,"d9a0"))},uniIcons:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(t.bind(null,"7eb3"))}},r=function(){var e=this.$createElement,o=(this._self._c,t("3289")),n=t("3289");this.$mp.data=Object.assign({},{$root:{m0:o,m1:n}})},i=[]},f3cb:function(e,o,t){}},[["5080","common/runtime","common/vendor"]]]);