(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/OrderDetails/OrderDetails"],{"0d4f":function(e,o,t){},"2c94":function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=t("7dcd"),i={data:function(){return{orderType:"",visible:!1,maskCloseAble:!0,defaultValue:"110101",column:3,name:"",phone:"",city:"",area:"",ab:{recipientName:"",code:"",phoneNumber:""},orderNo:"",orderAmount:"",from:"",detls:null,abList:[],fpList:[],commodityCode:"",fp:{invoiceType:"单位",invoiceTitle:"",taxNumber:"",companyAddress:"",phoneNumber:"",bankName:"",bankAccount:"",id:"",email:""},invoiceTitle:"",onlylook:1}},components:{cityPicker:function(){Promise.all([t.e("common/vendor"),t.e("uni_modules/piaoyi-cityPicker/components/piaoyi-cityPicker/piaoyi-cityPicker")]).then(function(){return resolve(t("c390"))}.bind(null,t)).catch(t.oe)}},onShow:function(){this.queryOrderInfoByOrderNo()},onLoad:function(e){console.log(e),this.orderType=e.orderType,this.orderNo=e.orderNo,this.from=e.from,this.abInfo=e.abInfo,this.fpInfo=e.fpInfo,this.onlylook=e.onlylook},methods:{queryOrderInfoByOrderNo:function(){var o=this;(0,n.queryOrderInfoByOrderNo)({orderNo:o.orderNo}).then((function(e){o.detls=e,"否"==e.isAddress&&"待发货"==e.status&&0==o.onlylook&&(o.open(),o.getAdss(o.from,o.abInfo)),"待收货"!=e.status&&"已完成"!=e.status||"否"!=e.isInvoice||0!=o.onlylook||(o.fpopen(),o.getFp(o.from,o.fpInfo))})).catch((function(o){e.showToast({title:o.data.msg||"queryOrderInfoByOrderNo接口异常,请稍后再试",icon:"none"})}))},selectOption:function(e){this.fp.invoiceType=e},getAdss:function(o,t){var i=this,r=e.getStorageSync("basicData"),s=JSON.parse(r);(0,n.queryUserAddressList)({userOpenid:s.userOpenid}).then((function(e){e.length>0?i.ab=e[0]:console.log(""),i.abList=e,"AddressList"==o&&t&&(i.ab=JSON.parse(t))})).catch((function(o){e.showToast({title:o.data.msg||"queryUserAddressList接口异常,请稍后再试",icon:"none"})}))},goAb:function(){e.redirectTo({url:"/pages/AddressList/AddressList?from=orderDetails&orderType="+this.orderType+"&orderNo="+this.detls.orderNo})},goFplist:function(){e.redirectTo({url:"/pages/InvoiceList/InvoiceList?from=orderDetails&orderType="+this.orderType+"&orderNo="+this.detls.orderNo})},getFp:function(o,t){var i=this,r=e.getStorageSync("basicData"),s=JSON.parse(r);(0,n.queryUserInvoiceList)({userOpenid:s.userOpenid}).then((function(n){n.length>0?i.fp=n[0]:console.log(""),i.fpList=n,"InvoiceList"==o&&t&&(i.fp=JSON.parse(t)),e.getStorageSync("emailAddress")&&(i.fp.email=e.getStorageSync("emailAddress"))})).catch((function(o){e.showToast({title:o.data.msg||"queryUserInvoiceList接口异常,请稍后再试",icon:"none"})}))},openCp:function(){this.visible=!0},confirm:function(e){console.log(e),this.city=e.name,this.provinceName=e.provinceName,this.cityName=e.cityName,this.areaName=e.areaName,this.visible=!1},cancel:function(){this.visible=!1},open:function(){this.$refs.popup.open("bottom")},fpopen:function(){this.$refs.popup1.open("bottom")},close:function(){this.$refs.popup.close()},fpclose:function(){this.$refs.popup1.close()},save:function(){var o=this,t=e.getStorageSync("basicData"),i=JSON.parse(t);if("0"==this.abList.length){if(""==this.name)return e.showToast({title:"请输入收货人姓名",icon:"none"}),!1;if(""==this.phone||!/^1[3-9]\d{9}$/.test(this.phone))return e.showToast({title:"请输入正确的手机号",icon:"none"}),!1;if(""==this.city)return e.showToast({title:"请选择所在地区",icon:"none"}),!1;if(""==this.area)return e.showToast({title:"请输入详细地址",icon:"none"}),!1;(0,n.createUserAddress)({userOpenid:i.userOpenid,recipientName:o.name,phoneNumber:o.phone,province:o.provinceName,city:o.cityName,district:o.areaName,detailedAddress:o.area}).then((function(e){o.bindAddressForOrder(e)})).catch((function(o){e.showToast({title:o.data.msg||"createUserAddress接口异常,请稍后再试",icon:"none"})}))}else o.bindAddressForOrder(o.ab.id)},fpsave:function(){var o=this,t=e.getStorageSync("basicData"),i=JSON.parse(t);if("个人"==o.fp.invoiceType){if(""==o.invoiceTitle)return e.showToast({title:"请输入发票抬头",icon:"none"}),!1;o.openInvoice("",o.fp.email,o.invoiceTitle)}else{if(""==o.fp.invoiceTitle)return e.showToast({title:"请输入发票抬头",icon:"none"}),!1;if(""==o.fp.taxNumber&&"单位"==o.fp.invoiceType)return e.showToast({title:"请输入正确的税号",icon:"none"}),!1;if(""==o.fp.email||!/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/.test(o.fp.email))return e.showToast({title:"请输入正确的邮箱",icon:"none"}),!1;"0"==o.fpList.length?(0,n.createUserInvoice)({userOpenid:i.userOpenid,invoiceType:o.fp.invoiceType,invoiceTitle:o.fp.invoiceTitle,taxNumber:o.fp.taxNumber,companyAddress:o.fp.companyAddress,phoneNumber:o.fp.phoneNumber,bankName:o.fp.bankName,bankAccount:o.fp.bankAccount}).then((function(e){o.openInvoice(e,o.fp.email,o.fp.invoiceTitle)})).catch((function(o){e.showToast({title:o.data.msg||"createUserInvoice接口异常,请稍后再试",icon:"none"})})):(0,n.updateUserInvoice)({userOpenid:i.userOpenid,invoiceType:o.fp.invoiceType,invoiceTitle:o.fp.invoiceTitle,taxNumber:o.fp.taxNumber,companyAddress:o.fp.companyAddress,phoneNumber:o.fp.phoneNumber,bankName:o.fp.bankName,bankAccount:o.fp.bankAccount,id:o.fp.id}).then((function(e){o.openInvoice(o.fp.id,o.fp.email,o.fp.invoiceTitle)})).catch((function(o){e.showToast({title:o.data.msg||"updateUserInvoice接口异常,请稍后再试",icon:"none"})}))}},bindAddressForOrder:function(o){var t=this;(0,n.bindAddressForOrder)({orderNo:t.orderNo,addressId:o}).then((function(){e.showToast({title:"保存成功",duration:2e3});var o=setTimeout((function(){t.close(),t.queryOrderInfoByOrderNo(),clearTimeout(o)}),1500)})).catch((function(o){e.showToast({title:o.data.msg||"bindAddressForOrder接口异常,请稍后再试",icon:"none"})}))},openInvoice:function(o,t,i){var r=this,s=e.getStorageSync("basicData"),a=JSON.parse(s);(0,n.openInvoice)({orderNo:r.orderNo,invoiceId:o,emailAddress:t,invoiceTitle:i,userOpenid:a.userOpenid}).then((function(){e.showToast({title:"保存成功",duration:2e3});var o=setTimeout((function(){r.fpclose(),r.queryOrderInfoByOrderNo(),clearTimeout(o)}),1500)})).catch((function(o){e.showToast({title:o.data.msg||"openInvoice接口异常,请稍后再试",icon:"none"})}))},go:function(o){var t=this;"确认收货"==o&&this.orderNo?e.showModal({title:"",content:"是否确认收货？",confirmColor:"#C0272C",success:function(o){if(o.confirm){var i=e.getStorageSync("basicData");JSON.parse(i);(0,n.updateOrderStatusForUser)({orderNo:t.orderNo,status:"已完成"}).then((function(o){e.showToast({title:"确认收货成功",duration:2e3});var n=setTimeout((function(){t.queryOrderInfoByOrderNo(),clearTimeout(n)}),1500)})).catch((function(o){e.showToast({title:o.data.msg||"updateOrderStatusForUser接口异常,请稍后再试",icon:"none"})}))}}}):"去付款"==o?e.navigateTo({url:"/pages/CashierDesk/CashierDesk?orderAmount="+this.detls.orderAmount+"&orderNo="+this.detls.orderNo}):"收货地址"==o?"待发货"==this.orderType&&(this.open(),this.getAdss(this.from,this.abInfo)):"开发票"==o?this.fpopen():"查看发票"==o&&e.navigateTo({url:"/pages/InvoiceList/InvoiceDetails/InvoiceDetails?orderNo="+this.orderNo})},goIndex:function(){var o=e.getStorageSync("basicData"),t=JSON.parse(o),n=JSON.stringify({userOpenid:t.userOpenid,commodityCode:this.detls.commodityCode});e.setStorageSync("basicData",n),e.navigateTo({url:"/pages/GoodsDetails/GoodsDetails?isBuy=1"})}}};o.default=i}).call(this,t("df3c")["default"])},"384a":function(e,o,t){"use strict";(function(e,o){var n=t("47a9");t("7ea0");n(t("3240"));var i=n(t("c43a"));e.__webpack_require_UNI_MP_PLUGIN__=t,o(i.default)}).call(this,t("3223")["default"],t("df3c")["createPage"])},"7ab4":function(e,o,t){"use strict";t.d(o,"b",(function(){return i})),t.d(o,"c",(function(){return r})),t.d(o,"a",(function(){return n}));var n={uniPopup:function(){return t.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(t.bind(null,"d9a0"))},uniIcons:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(t.bind(null,"7eb3"))}},i=function(){var e=this.$createElement,o=(this._self._c,this.abList.length),t="单位"==this.fp.invoiceType?this.fpList.length>0&&"单位"==this.fp.invoiceType:null;this.$mp.data=Object.assign({},{$root:{g0:o,g1:t}})},r=[]},aa92:function(e,o,t){"use strict";var n=t("0d4f"),i=t.n(n);i.a},b7f4:function(e,o,t){"use strict";t.r(o);var n=t("2c94"),i=t.n(n);for(var r in n)["default"].indexOf(r)<0&&function(e){t.d(o,e,(function(){return n[e]}))}(r);o["default"]=i.a},c43a:function(e,o,t){"use strict";t.r(o);var n=t("7ab4"),i=t("b7f4");for(var r in i)["default"].indexOf(r)<0&&function(e){t.d(o,e,(function(){return i[e]}))}(r);t("aa92");var s=t("828b"),a=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,"9a984f3e",null,!1,n["a"],void 0);o["default"]=a.exports}},[["384a","common/runtime","common/vendor"]]]);